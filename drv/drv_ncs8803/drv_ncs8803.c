#include "drv_log.h"
#include "hal_soft_i2c.h"
#include "drv_ncs8803.h"
#include "hal_delay.h"
void Ncs8803_1920_1080_Write(void)
{
    uint8_t write_bytes[] = {0x10,0x10,0x0D,0x11,0x00,0x00,0x01,0x05,0x00,0x05,0xc2,0x01,0x00,0x08,0x98,0x00,0xc0,0x07,0x80,0x04,0x65,0x00,0x29,0x04,0x38,0x00,0x2c,0x00,0x05,0x00,0x00,0x01,0x00,0x20,0xb0,0x00,0x5c,0x47,0x06,0x06,0x88,0x04,0x40,0x00,0x32,0xb1,0x00,0x07,0xff,0xf7,0xff,0xff,0x80,0x00,0x40,0x03};
    uint8_t write_addr [] = {0xa3,0x5d,0x5e,0xa3,0xeb,0xed,0x0f,0x00,0x01,0x02,0x07,0x09,0x0b,0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x60,0x70,0x71,0x73,0x74,0x00,0x01,0x02,0x0b,0x0e,0x0f,0x11,0x2c,0x2d,0x84,0x85,0x00,0x0f,0x2b,0x2e,0x2f,0x30,0x31,0x35,0x34,0x34,0x36};
    uint8_t write_dev  [] = {0xe0,0xea,0xea,0xe0,0xea,0xea,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xe0,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea};
    for(int i = 0; i < 56; i++)
    {
        I2cDeviceWriteBytes(0, write_dev[i], write_addr[i], 1, &write_bytes[i], 1);
        DelayMs(2);
    }
}

uint8_t *Ncs8803_1920_1080_Read(void)
{
    static uint8_t read_bytes[56] = {0};
    uint8_t read_addr [] = {0xa3,0x5d,0x5e,0xa3,0xeb,0xed,0x0f,0x00,0x01,0x02,0x07,0x09,0x0b,0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x60,0x70,0x71,0x73,0x74,0x00,0x01,0x02,0x0b,0x0e,0x0f,0x11,0x2c,0x2d,0x84,0x85,0x00,0x0f,0x2b,0x2e,0x2f,0x30,0x31,0x35,0x34,0x34,0x36};
    uint8_t read_dev  [] = {0xe0,0xea,0xea,0xe0,0xea,0xea,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xe0,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea,0xea};
    for(int i = 0; i < 56; i++)
    {
        I2cDeviceReadBytes(0, read_dev[i], read_addr[i], 1, &read_bytes[i], 1);
        DelayMs(2);
        LOG("dev:0x%02x = 0x%02x", read_addr[i], read_bytes[i]);
    }

    return read_bytes;
}
void FRC()
{
        for(uint8_t j = 0; j < 3; j++)
        {
            uint8_t data_c5 = j;
            I2cDeviceWriteBytes(0, 0xE0, 0xc5, 1, &data_c5, 1);

            for(uint8_t i = 0; i < 252; i++)
            {
                uint8_t data_c6 = i;
                I2cDeviceWriteBytes(0, 0xE0, 0xc6, 1, &data_c6, 1);
                uint8_t data_c7c8 = (0x000c | (data_c6 & 0x03)) | ((uint)(data_c6 & 0xfc) << 2);
                uint8_t data_c7 = data_c7c8 >> 8;
                uint8_t data_c8 = data_c7c8;
                I2cDeviceWriteBytes(0, 0xE0, 0xc7, 1, &data_c7, 1);
                I2cDeviceWriteBytes(0, 0xE0, 0xc8, 1, &data_c8, 1);
            }
            for(int i = 252; i < 256; i++)
            {
                uint8_t data_c6 = i;
                I2cDeviceWriteBytes(0, 0xE0, 0xc6, 1, &data_c6, 1);
                uint8_t data_c7c8 = (0x0000 | (data_c6 & 0x03)) | ((uint)(data_c6 & 0xfc) << 2);
                uint8_t data_c7 = data_c7c8 >> 8;
                uint8_t data_c8 = data_c7c8;
                I2cDeviceWriteBytes(0, 0xE0, 0xc7, 1, &data_c7, 1);
                I2cDeviceWriteBytes(0, 0xE0, 0xc8, 1, &data_c8, 1);
            }
        }
        uint8_t send_byte = 0xe0;
        I2cDeviceWriteBytes(0, 0xE0, 0x60, 1, &send_byte, 1);
}


void Hdmi_Det()
{
    while(1)
    {
        uint8_t rev_data [2] = {0x00, 0x00};
        uint8_t send_data[2] = {0xB0, 0xB1};

        I2cDeviceReadBytes(0, 0xEA, 0xE2, 1, &rev_data[0], 1);

        I2cDeviceReadBytes(0, 0xEA, 0xE4, 1, &rev_data[1], 1); // 读取75寄存器E4的值
        if(rev_data[0] != rev_data[1])  //不同屏参设定读出的E4值会有出入，请参加正常显示读出的值做判断依据
        {
            I2cDeviceWriteBytes(0, 0xEA, 0x00, 1, &send_data[0], 1);
            I2cDeviceWriteBytes(0, 0xEA, 0x00, 1, &send_data[1], 1);
            DelayMs(50);  //延时100ms
        }

        if(rev_data[0] == rev_data[1])
        {
            break;//NCS8803 配置完成
        }
    }
}




